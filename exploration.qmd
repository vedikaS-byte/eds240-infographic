---
title: "Early Data Exploration & Visualization of a Spotify Hit"
format: html
execute: 
  warning: false
  message: false
---

The purpose of this document is to detail exploratory data exploration and visualization of the primary Spotify hits dataset obtained from Kaggle and organized by Solomon Ameh. Final versions of summarized data and visualizations are subject to change.

### **Import & Wrangle Data**

Here, the necessary packages are loaded, and the Spotify dataset is read from the local directory.

```{r}
library(tidyverse)
library(ggthemes)
```

```{r}
# Import most popular songs
high_popular <- read.csv(
  here::here("data", "high_popularity_spotify_data.csv"))
```

The dataset is filtered to retain only variables relevant to answer each question, ensuring a focused and efficient visualization workflow.

```{r}
# Select variables relevant to the analysis and double check for duplicates of the same track
spotify_clean <- high_popular %>% 
  select( track_id, track_name, track_artist,
    playlist_genre, playlist_subgenre,
    track_popularity,
    valence, energy, danceability) %>% 
  distinct() %>% # Remove duplicates
drop_na()
```

Because the research questions utilized to construct this infographic emphasize popularity, songs are classified into popularity groups to streamline faceted visualization. It is important to note that popularity bins were defined based on this author’s judgment and may be revised following further discussion with the instructor.

```{r}
# Range of 68-100%
# summary() reveals that there is clustering and heavy skew towards lower range of values
summary(spotify_clean$track_popularity)

# Visualize right skew
hist(spotify_clean$track_popularity)
```

```{r}
# Bin popularity based on dividing scores into three equally sized popularity groups using distribution of popularity values 
quantile(spotify_clean$track_popularity, probs = c(0, .33, .66, 1))

spotify_clean <- spotify_clean %>%
  mutate(
    popularity_group = case_when(
      track_popularity <= 72 ~ "Lower Popularity",
      track_popularity <= 77 ~ "Mid Popularity",
      TRUE ~ "High Popularity"
    )
  )
```

### **Exploratory Data Visualizations**

-   Create at least **three** exploratory data visualizations (but of course feel free to create more!). The goal of these visualizations is to explore your data for any potentially interesting patterns or trends, which you or may not decide to pursue further as you iterate on your final project deliverable. These plots *do not* need to be polished (e.g. updated theme), but it may be helpful to try arranging data to identify any trends. **NOTE:** You may need to create differently arranged subsets of your data in order to produce your various exploratory data visualizations.

#### Are hit songs happier? 

```{r}
# Create a summary table for distribution of valence score based on popularity 
valence_dist <- spotify_clean %>% 
  select(popularity_group, valence)
```

```{r}
# Violin and boxplot overlaid to visualize distribution
valence_dist %>% 
  ggplot(aes(x = popularity_group, y = valence, fill = popularity_group)) +
  geom_violin(trim = F, alpha = 0.3) +
  geom_boxplot(width = .1, outlier.shape = NA)+
  labs(
    title = "Are Hit Songs Happier?",
    subtitle = "Valence distributions across popularity groups",
    x = "Popularity Group",
    y = "Valence (Happiness Score)"
  ) + guides(fill = "none") + 
  theme_igray()
```

```{r}
# Stacked histograms for valence scores based on popularity group
valence_dist %>% 
  ggplot(aes(x = valence, fill = popularity_group)) +
  geom_histogram(bins = 30, col = "black", alpha = .4) +
  #facet_wrap(~ popularity_group) +
  labs(
    title = "Valence Distribution by Popularity Group",
    x = "Valence",
    y = "Count"
  ) + theme_igray()

# Faceted histograms for valence scores based on popularity group
valence_dist %>% 
  ggplot(aes(x = valence, fill = popularity_group)) +
  geom_histogram(bins = 30, col = "black", alpha = .4) +
  facet_wrap(~ popularity_group) + guides(fill = "none") + 
  labs(
    title = "Valence Distribution by Popularity Group",
    x = "Valence",
    y = "Count"
  ) + theme_igray() 
```

#### Do popular songs cluster around certain energy-danceability combinations?

```{r}
# Create a subset with only the energy and daceability score
energy_dance_df <- spotify_clean %>%
  select(energy, danceability, popularity_group)

# Scatter plot of energy score against danceability of a track based on pop group
energy_dance_df %>% 
  ggplot(aes(x = energy, y = danceability, color = popularity_group)) +
  geom_point(alpha = 0.4) + 
  labs(
    title = "Energy vs Danceability by Popularity Group",
    x = "Energy",
    y = "Danceability",
    color = "Popularity Group"
  ) +
  theme_igray()

# Faceted scatter plot of energy-dancebility clustering based on popularity
energy_dance_df %>% 
  ggplot(aes(x = energy, y = danceability, color = popularity_group)) +
  geom_point(alpha = 0.4) + 
  facet_wrap(~popularity_group) + 
  guides(color = "none") + 
  labs(
    title = "Energy vs Danceability by Popularity Group",
    x = "Energy",
    y = "Danceability",
    color = "Popularity Group"
  ) +
  theme_igray()

# Faceted density plot of energy-dancebility clustering based on popularity
energy_dance_df %>% 
  ggplot(aes(x = energy, y = danceability)) +
  stat_density_2d() +
  facet_wrap(~popularity_group) +
  labs(
    title = "Energy-Danceability Clusters by Popularity Group",
    x = "Energy",
    y = "Danceability"
  ) +
  theme_igray()

```

#### Which genre dominates Spotify hits? 

```{r}
genre_hits <- spotify_clean %>%
  filter(popularity_group == "High Popularity") %>%
  count(playlist_genre) %>%
  mutate(percent_hit_genre = n / sum(n))

genre_hits %>% ggplot(aes(x = reorder(playlist_genre, percent_hit_genre), y = percent_hit_genre)) +
  geom_col(alpha = .7) +
  coord_flip() +
  labs(
    title = "Genres That Dominate High-Popularity Songs",
    x = "Genre",
    y = "Proportion of Hit Songs"
  ) +
  theme_igray()
```

### **V. Answer questions**

**After completing the above steps, answer the following questions:**

-   **1.** What have you learned about your data? Have any potentially interesting patterns emerged? Point to specific visualizations that you created as you describe your findings.

-   **2.** In [FPM #1](https://eds-240-data-viz.github.io/course-materials/assignments/FPM1.html), you outlined some questions that you wanted to answer using these data. Have you made any strides towards answering those questions? If yes, how so? If no, what next steps do you need to take (e.g. I need to create X plot type, I still need to track down Y data, I need to restructure existing data so that you can visualize it in Z ways, etc.)? Have any new questions emerged?

-   **3.** What challenges do you foresee encountering with your data? These can be data wrangling and / or visualization challenges.
